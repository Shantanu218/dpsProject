<% layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/styles/previewImages.css" class="rel">


<div class="row">
	<h1 class="text-center">Edit <%= project.title %></h1>
	<div class="col-6 offset-3">
		<form action="/projects/<%= project._id %>?_method=PUT" method="post" class="needs-validation" novalidate enctype="multipart/form-data">
			<div class="form-floating mb-3">
				<input type="text" class="form-control" id="title" placeholder="foo" name="project[title]" value="<%= project.title %>" required>
				<label for="title">Title</label>
				<div class="valid-feedback">
					Looks good!
				</div>
				<div class="invalid-feedback">
					Please provide a title!
				</div>
			</div>
			<div class="form-floating mb-3">
				<select class="form-select" id="subjectOptions" required name="project[subject]">
					<option value="" disabled>--Please select an option--</option>
					<option value="<%= project.subject %>" selected hidden><%= project.subject %></option>
					<option value="Biology">Biology</option>
					<option value="Chemistry">Chemistry</option>
					<option value="English">English</option>
					<option value="Mathematics">Mathematics</option>
					<option value="Physics">Physics</option>
				</select>
				<label for="subjectOptions">Subject</label>
				<div class="valid-feedback">
					Looks good!
				</div>
				<div class="invalid-feedback">
					Please choose a subject!
				</div>
			</div>

			<div class="row">
				<div class="col-6">
					<div class="form-floating mb-3">
						<select class="form-select" id="gradeOptions" required name="project[grade]">
							<option value="" selected disabled>--Please select an option--</option>
							<option value="<%= project.grade %>" selected hidden>Grade <%= project.grade %></option>
							<% for( let index = 1; index < 13; index++ ) { %>
							<option value="<%= index %>" id="grade<%= index %>">Grade <%= index %></option>
							<% } %>
						</select>
						<label for="gradeOptions">Grade</label>
						<div class="valid-feedback">
							Looks good!
						</div>
						<div class="invalid-feedback">
							Please choose a grade!
						</div>
					</div>
				</div>
				<div class="col-6">
					<div class="form-floating mb-3">
						<select class="form-select" id="sectionOptions" required name="project[section]">
							<option value="" selected disabled id="defOption">--Please select an option--</option>
							<option value="<%= project.section %>" selected hidden><%= project.section %></option>
						</select>
						<label for="sectionOptions">Section</label>
						<div class="valid-feedback">
							Looks good!
						</div>
						<div class="invalid-feedback">
							Please choose a section!
						</div>
					</div>
				</div>
			</div>

			<div class="form-floating mb-3">
				<select class="form-select" id="yearOptions" required name="project[year]">
					<option value="" selected disabled>--Please select an option--</option>
					<option value="<%= project.year %>" selected hidden><%= project.year %> - <%= project.year + 1 %></option>
					<% for(let a = 2010; a < 2040; a++) { %>
					<option value="<%= a %>" id="year<%= a %>"><%= a %> - <%= a+1 %></option>
					<% } %>
				</select>
				<label for="yearOptions">Academic Year</label>
				<div class="valid-feedback">
					Looks good!
				</div>
				<div class="invalid-feedback">
					Please choose a year!
				</div>
			</div>

			<div class="mb-3">
				<div class="custom-file">
					<label for="images" class="form-label custom-file-label">
						<span class="form-file-text text-muted">Project images/videos, if any</span></label>
					<input class="form-control custom-file-input" type="file" id="images" name="image" multiple
						   onchange="previewMultiple(event), validateSize(event)">
					<span class="form-file-text text-muted"><i>Make sure your files are
							under 200MB!</i></span>
				</div>
				<div class="valid-feedback">
					Looks good!
				</div>
				<div id="formFile">
				</div>
				<span id="formFileSpan"></span>
				<div id="clearDiv" style="display: none; margin-top: 5px;">
					<button type="button" class="btn btn-danger" onclick="clearAll(this)">Clear all
						images</button>
				</div>
			</div>

			<div class="form-floating mb-3">
				<textarea type="text" class="form-control" id="description" style="resize: none; height: 200px;"
						  placeholder="foo" name="project[description]" required><%= project.description %></textarea>
				<label for="description">Description</label>
				<div class="valid-feedback">
					Looks good!
				</div>
				<div class="invalid-feedback">
					Please provide a description!
				</div>
			</div>

			<div class="mb-3">
				<div class="container d-flex" style="flex-direction: row; flex-wrap:wrap; padding: 0;">
					<% for(a = 0; a < project.images.length; a++) { %>
					<div class="card cardDiv" id="cardDiv<%= a %>" style="margin-bottom: 30px;">
						<img crossorigin=" anonymous" src="<%= project.images[a].thumbnail %>" class="card-img-top"
							 alt="project image <%= a+1 %>" style="aspect-ratio: 4 / 3; margin-bottom: 30px;">
						<div class="card-body">
							<h5 class="card-title" style="font-size: 15px;">Filename: <%= project.images[a].originalname %> <br>Size:
								<%= (project.images[a].size / 1000 / 1000).toFixed(2) %> Megabytes
							</h5>
							<div class="form-check form-switch">
								<input class="form-check-input" type="checkbox" role="switch" name="deleteImages[]"
									   value="<%= project.images[a].filename %>" id="checkbox<%= a %>">
								<label class="form-check-label text-muted" for="checkbox<%= a %>"><i>Toggle to delete</i></label>
							</div>
						</div>
					</div>
					<% } %>
				</div>
			</div>

			<div class="mb-3">
				<button type="submit" class="btn btn-primary">Save project</button>
				<a href="/projects/<%= project._id %>" class="btn btn-danger">Go back</a>
			</div>

		</form>

	</div>
</div>

<script src="/scripts/addSections.js"></script>

<script src="/scripts/addFileNames.js"></script>
<script>
	const jsonProject = JSON.parse('<%-JSON.stringify(project)%>');
	// const jsonProject = < % - JSON.stringify(project) %>;
	let imageCount = jsonProject.images.length;
	console.log(jsonProject)

	console.log(imageCount)
</script>
<script src="/scripts/validateSize.js"></script>